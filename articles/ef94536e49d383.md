---
title: 'TypeScriptã§ æ•°å€¤åˆ—æŒ™å‹ ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆæ–‡å­—åˆ—ï¼‰ ã¨ å€¤ï¼ˆæ•°å€¤ï¼‰ ã‚’ç›¸äº’å¤‰æ›ã™ã‚‹'
emoji: 'ğŸ”„ï¸'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['TypeScript', 'Enum']
published: false
---

# å®Ÿç¾ã—ãŸã„ã“ã¨

- TypeScript ã® æ•°å€¤åˆ—æŒ™å‹ ã§ä»¥ä¸‹ã‚’å®Ÿç¾ã—ãŸã„
  1. enum ã®ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰å€¤ã‚’å–å¾—
  1. enum ã®å€¤ã‹ã‚‰ãƒ¡ãƒ³ãƒãƒ¼ã‚’å–å¾—

:::details å‹•æ©Ÿ

- çŠ¶æ³
  - ç›¸äº’å¤‰æ›ãŒå¿…è¦æ€§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ Client(App/Web)ã¨ã®é€šä¿¡ã‚’ä»²ä»‹ã™ã‚‹ BFF ã§ç™ºç”Ÿã—ãŸã€‚
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® schema å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ ts ã‚³ãƒ¼ãƒ‰ã‚’ generate ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä»•æ§˜ã¨ã—ã¦ã€enum å®šç¾©ã¯æ•°å€¤åˆ—æŒ™å‹ã§ generate ã•ã‚ŒãŸã€‚
  - ã‚ˆã£ã¦ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰æ¥ãŸ enum å€¤ã¯ BFF å†…ã§ã¯æ•°å€¤ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã€‚
  - ä¸€æ–¹ã§ Client ã¯ enum å®šç¾©ã®ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆæ–‡å­—åˆ—ï¼‰ã‚’å¿…è¦ã¨ã—ã¦ã„ãŸã€‚
  - ãã®ãŸã‚ã€
    - Client -> BFF -> ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ã®å ´åˆã¯ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰å€¤ã¸ã®å¤‰æ›
    - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ -> BFF -> Client ã®å ´åˆã¯å€¤ã‹ã‚‰ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®å¤‰æ›
  - ãŒå¿…è¦ã ã£ãŸ

:::

## TL;DR

ä»¥ä¸‹ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚

```ts:convert-between-enum-and-string.ts
enum RoleEnum {
  ADMIN = 0,
  READ_ONLY = 1,
}

type RoleMember = keyof typeof RoleEnum;

const RoleMemberObj: Record<RoleMember, RoleMember> = {
  ADMIN: 'ADMIN',
  READ_ONLY: 'READ_ONLY',
};

const isRoleMember = (str: string): str is RoleMember => {
  return str in RoleMemberObj;
};

const convertStrToEnum = (str: string): RoleEnum => {
  if (isRoleMember(str)) {
    return RoleEnum[str];
  } else {
    throw new Error(`RoleEnum[${str}] ã¯compile error.`);
  }
};

const convertEnumToStr = (enumVal: RoleEnum): RoleMember => {
  if (isRoleMember(RoleEnum[enumVal])) {
    return RoleEnum[enumVal];
  } else {
    throw new Error(
      `${RoleEnum[enumVal]} ã¯undefiend (compile errorã§ã¯ãªã„).`
    );
  }
};

```

å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ã®å¼•æ•°ã‚’ string ã¨ã™ã‚‹ã“ã¨ã§ã€enum ã®ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰ã§ã‚‚ã€enum ã®å€¤ã‹ã‚‰ã§ã‚‚ã€ãã®å¼•æ•°ã«å¯¾ã—ã¦å‹æƒ…å ±ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
const isRoleMember = (str: string): str is RoleMember => {
  return str in RoleMemberObj;
};
```

## æ¯”è¼ƒ

| ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå®Ÿè£…ã¯ä¸‹è¨˜å‚ç…§ã€ãƒ«ãƒ¼ãƒ—å›æ•° 1000000 å›ï¼‰ | str -> enum é€Ÿåº¦(ms) | str -> enum ãƒ¡ãƒ¢ãƒª(MB)       | enum -> str é€Ÿåº¦(ms) | enum -> str ãƒ¡ãƒ¢ãƒª(MB)       |
| ------------------------------------------------- | -------------------- | ---------------------------- | -------------------- | ---------------------------- |
| member objectï¼ˆä¸Šè¿°ã®å®Ÿè£…ï¼‰                       | 1.3112               | RSS: 0.13<br>Heap Used: 0.07 | 1.4312               | RSS: 0.08<br>Heap Used: 0.07 |
| pair object                                       | 1.3151               | RSS: 0.09<br>Heap Used: 0.07 | 1.1735               | RSS: 0.09<br>Heap Used: 0.06 |
| array                                             | 4.1215               | RSS: 0.14<br>Heap Used: 4.14 | 3.6270               | RSS: 0.08<br>Heap Used: 3.89 |
| map                                               | 15.8714              | RSS: 8.66<br>Heap Used: 9.05 | 178.0986             | RSS: 8.67<br>Heap Used: 4.72 |

### æ¯”è¼ƒå®Ÿè£…

```ts:pair_object.ts
// pair object
const RolePairObj: Record<RoleMember, RoleEnum> & Record<RoleEnum, RoleMember> =
  {
    ADMIN: RoleEnum.ADMIN,
    READ_ONLY: RoleEnum.READ_ONLY,
    [RoleEnum.ADMIN]: 'ADMIN',
    [RoleEnum.READ_ONLY]: 'READ_ONLY',
  };

const isRoleMemberForPairObj = (str: string): str is RoleMember => {
  return str in RoleMemberObj;
};

const convertStrToEnumByPairObj = (str: string): RoleEnum => {
  // pair object ã§ã‚‚å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ã¯å¿…è¦
  if (isRoleMemberForPairObj(str)) {
    return RoleEnum[str];
  } else {
    throw new Error(`RoleEnum[${str}] ã¯compile error.`);
  }
};

const convertEnumToStrByPairObj = (enumVal: RoleEnum): RoleMember => {
  return RolePairObj[enumVal];
};
```

```ts:array.ts
// array
const RolePairArr: {
  roleMember: RoleMember;
  roleEnum: RoleEnum;
}[] = [
  { roleMember: 'ADMIN', roleEnum: RoleEnum.ADMIN },
  { roleMember: 'READ_ONLY', roleEnum: RoleEnum.READ_ONLY },
];

const convertStrToEnumByArr = (str: string): RoleEnum | undefined => {
  return RolePairArr.find((role) => role.roleMember === str)?.roleEnum;
};

const convertEnumToStrByArr = (enumVal: RoleEnum): RoleMember | undefined => {
  return RolePairArr.find((role) => role.roleEnum === enumVal)?.roleMember;
};
```

```ts:map.ts
// map
const RolePairMap = new Map<RoleMember, RoleEnum>([
  ['ADMIN', RoleEnum.ADMIN],
  ['READ_ONLY', RoleEnum.READ_ONLY],
]);

const isRoleMemberForMap = (str: string): str is RoleMember => {
  return str in RoleMemberObj;
};

const convertStrToEnumByMap = (str: string): RoleEnum | undefined => {
  if (isRoleMemberForMap(str)) {
    return RolePairMap.get(str);
  }
};

const convertEnumToStrByMap = (enumVal: RoleEnum): RoleMember | undefined => {
  return [...RolePairMap.entries()].find(
    ([, roleEnum]) => roleEnum === enumVal
  )?.[0];
};
```

:::details æ¸¬å®šå®Ÿè£…

```ts:measure.ts
const logMemoryUsage = (
  message: string,
  recent: NodeJS.MemoryUsage,
  compare?: NodeJS.MemoryUsage
) => {
  console.log(message);
  console.log(
    `RSS: ${((recent.rss - (compare?.rss ?? 0)) / 1024 / 1024).toFixed(2)} MB`
  );
  console.log(
    `Heap Used: ${(
      (recent.heapUsed - (compare?.heapUsed ?? 0)) /
      1024 /
      1024
    ).toFixed(2)} MB`
  );
	console.log('---------------------');
};

const measure = (func: () => any, times = 1e6) => {
  const beforeMemory = process.memoryUsage();
  logMemoryUsage('Before Execution', beforeMemory);

  performance.mark('start');

  for (let i = 0; i < times; i++) {
    func();
  }

  performance.mark('end');
  performance.measure('Execution Time', 'start', 'end');
  const afterMemory = process.memoryUsage();
  logMemoryUsage('After Execution', afterMemory);

  logMemoryUsage('Memory Usage Diff', afterMemory, beforeMemory);

  const timeMeasure = performance.getEntriesByName('Execution Time');
  console.log(`Execution Time: ${timeMeasure[0].duration}ms`);
};

const main = () => {
  const str: string = 'ADMIN';

  measure(() => convertStrToEnum(str));
};

main();

```

:::

## æ¡ç”¨ç†ç”±

- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã ã‘ã‚’è¦‹ã‚Œã° pair object ãŒæœ€ã‚‚è‰¯ã„
- ã—ã‹ã—ã€å‹ã‚’äº¤å·®å‹ã§ä½œã‚‹å¿…è¦ãŒã‚ã‚Šã€å‹ã«å·¥å¤«ãŒå¿…è¦ãªå ´åˆã«å†—é•·ã«ãªã‚‹

:::details å‹ã«å·¥å¤«ãŒå¿…è¦ãªä»Šå›ã®ã‚±ãƒ¼ã‚¹

- å‹ã«å·¥å¤«ã¨ã¯ï¼šä»Šå›ã¯ schemaã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä»•æ§˜ã«ã‚ˆã‚Šä¸è¦ãª enum å€¤ãŒ generate ã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€ãã‚Œã‚’é™¤ãå¿…è¦ãŒã‚ã£ãŸ

```ts:å®Ÿéš›ã®ä¾‹
enum RoleEnum {
  UNSPECIFIED = 0,
  ADMIN = 1,
  READ_ONLY = 2,
}

type RoleMember = Exclude<keyof typeof RoleEnum, 'UNSPECIFIED'>;
type RoleEnumType = Exclude<RoleEnum, RoleEnum.UNSPECIFIED>;

// UNSPECIFIED ãŒä¸è¦ã ãŒã€convertEnumToStrByPairObj()ã®å‹ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚Objectã«ã¯å¿…è¦
// å‹ãŒå†—é•·ã«ãªã£ã¦ã—ã¾ã†
const RolePairObj: Record<RoleMember, RoleEnum> & Record<RoleEnum.UNSPECIFIED, undefiend> & Record<RoleEnumType, RoleMember> =
  {
    ADMIN: RoleEnum.ADMIN,
    READ_ONLY: RoleEnum.READ_ONLY,
    [RoleEnum.UNSPECIFIED]: undefined,
    [RoleEnum.ADMIN]: 'ADMIN',
    [RoleEnum.READ_ONLY]: 'READ_ONLY',
  };

const convertEnumToStrByPairObj = (enumVal: RoleEnum): RoleMember | undefiend => {
  return RolePairObj[enumVal];
};

```

:::

ã‚‚ã—ä¸Šè¨˜ãŒã‚¯ãƒªã‚¢ã§ãã‚‹ã®ã§ã‚ã‚Œã°ã€pair object ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã—ãŸã»ã†ãŒè‰¯ã„å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚

## ã‚ã¨ãŒã

æœ¬å½“ãªã‚‰å¤‰æ›ãŒå¿…è¦ãªã„ã‚ˆã†ãª API è¨­è¨ˆã«ã§ãã‚Œã°ã“ã®ã‚ˆã†ãªã“ã¨ã‚’è€ƒãˆãªãã¦ã‚‚è‰¯ã‹ã£ãŸã®ã ã‚ã†ã¨ã¯æ€ã£ã¦ã¾ã™...ã€‚

ãŸã ã€ã‚„ã‚€ã«ã‚„ã¾ã‚Œãšå¿…è¦ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã¨æ€ã„ã€æ¤œç´¢ã—ã¦ã‚‚å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã›ãšã«å®Ÿç¾ã—ã¦ã€ã‹ã¤æ¯”è¼ƒã—ã¦ã„ã‚‹æƒ…å ±ã¯è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã¾ã¨ã‚ã¾ã—ãŸã€‚
